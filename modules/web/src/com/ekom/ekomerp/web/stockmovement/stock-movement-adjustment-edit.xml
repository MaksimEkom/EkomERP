<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/window.xsd"
        caption="msg://editorCaption"
        class="com.ekom.ekomerp.web.stockmovement.StockMovementAdjustmentEdit"
        datasource="stockMovementDs"
        focusComponent="stockMovementLineDataGrid"
        messagesPack="com.ekom.ekomerp.web.stockmovement">
    <dsContext>
        <datasource id="stockMovementDs"
                    class="com.ekom.ekomerp.entity.StockMovement"
                    view="stockMovement-edit">
            <collectionDatasource id="stockMovementLineDs"
                                  property="stockMovementLine"/>
        </datasource>
        <collectionDatasource id="locationsDs"
                              class="com.ekom.ekomerp.entity.Location"
                              view="_minimal">
            <query>
                <![CDATA[select e from ekomerp$Location e]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="locationsFilteredDs"
                              class="com.ekom.ekomerp.entity.Location"
                              view="_minimal">
            <query>
                <![CDATA[select e from ekomerp$Location e
where e.stockman.id = :session$userId]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="productsDs"
                              class="com.ekom.ekomerp.entity.Product"
                              view="productWithUnit">
            <query>
                <![CDATA[select e from ekomerp$Product e
order by e.name asc]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <dialogMode height="600"
                width="800"/>
    <layout expand="windowActions"
            spacing="true">
        <hbox spacing="true">
            <vbox spacing="true">
                <label id="stockMovementLabel"
                       stylename="h2 bold"
                       value="msg://Stock Adjustment"/>
                <label id="numberLabel"
                       datasource="stockMovementDs"
                       property="number"
                       stylename="h1"/>
            </vbox>
        </hbox>
        <fieldGroup id="fieldGroup"
                    datasource="stockMovementDs">
            <column width="250px">
                <field id="date"/>
                <field id="location"
                       optionsDatasource="locationsDs"/>
                <field id="notes"
                       rows="5"/>
            </column>
        </fieldGroup>
        <dataGrid id="stockMovementLineDataGrid"
                  datasource="stockMovementLineDs"
                  editorEnabled="true"
                  height="200px"
                  width="100%">
            <actions>
                <action id="create"/>
                <action id="edit"/>
                <action id="remove"/>
            </actions>
            <columns>
                <column id="product"
                        property="product"/>
                <column id="code"
                        editable="false"
                        property="product.code"/>
                <column id="unit"
                        editable="false"
                        property="product.unit"/>
                <column id="quantity"
                        property="quantity"/>
                <column id="quantityBefore"
                        property="quantityBefore"/>
                <column id="quantityAfter"
                        property="quantityAfter"/>
            </columns>
            <buttonsPanel>
                <button id="createButton"
                        caption="msg://Create"
                        invoke="onCreateButtonClick"/>
                <button id="removeButton"
                        action="stockMovementLineDataGrid.remove"/>
            </buttonsPanel>
        </dataGrid>
        <frame id="windowActions"
               screen="extendedEditWindowActions"/>
    </layout>
</window>
