<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/window.xsd"
        caption="msg://editorAdjustmentCaption"
        class="com.ekom.ekomerp.web.stockmovement.StockMovementAdjustmentEdit"
        datasource="stockMovementDs"
        messagesPack="com.ekom.ekomerp.web.stockmovement">
    <dsContext>
        <datasource id="stockMovementDs"
                    class="com.ekom.ekomerp.entity.StockMovement"
                    view="stockMovement-edit">
            <collectionDatasource id="stockMovementLineDs"
                                  property="stockMovementLine"/>
        </datasource>
        <collectionDatasource id="locationsDs"
                              class="com.ekom.ekomerp.entity.Location"
                              view="_minimal">
            <query>
                <![CDATA[select e from ekomerp$Location e]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="locationsFilteredDs"
                              class="com.ekom.ekomerp.entity.Location"
                              view="_minimal">
            <query>
                <![CDATA[select e from ekomerp$Location e
where e.stockman.id = :session$userId]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="productsDs"
                              class="com.ekom.ekomerp.entity.Product"
                              view="productWithUnit">
            <query>
                <![CDATA[select e from ekomerp$Product e
order by e.name asc]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <dialogMode height="600"
                width="800"/>
    <layout expand="stockMovementLineTable"
            spacing="true">
        <hbox spacing="true"
              width="100%">
            <vbox spacing="true">
                <label id="stockMovementLabel"
                       stylename="h2 bold"
                       value="msg://Stock Adjustment"/>
                <label id="numberLabel"
                       datasource="stockMovementDs"
                       property="number"
                       stylename="h1"/>
            </vbox>
            <dateField align="MIDDLE_LEFT"
                       caption="msg://Date"
                       datasource="stockMovementDs"
                       property="date"
                       width="200px"/>
        </hbox>
        <lookupField id="locationLookupField"
                     caption="msg://Location"
                     datasource="stockMovementDs"
                     property="location"
                     width="300px"/>
        <table id="stockMovementLineTable"
               editable="true"
               stylename="borderless"
               width="100%">
            <actions>
                <action id="create"/>
                <action id="edit"
                        enable="false"
                        visible="false"/>
                <action id="remove"/>
            </actions>
            <columns>
                <column id="product"
                        editable="true"/>
                <column id="product.code"/>
                <column id="product.unit"/>
                <column id="quantity"
                        editable="true"/>
                <column id="quantityBefore"/>
                <column id="quantityAfter"
                        editable="true"/>
            </columns>
            <rows datasource="stockMovementLineDs"/>
            <buttonsPanel>
                <button id="createButton"
                        caption="msg://Create"
                        invoke="onCreateButtonClick"/>
                <button id="removeButton"
                        action="stockMovementLineTable.remove"/>
            </buttonsPanel>
        </table>
        <textArea datasource="stockMovementDs"
                  inputPrompt="msg://Notes"
                  property="notes"
                  width="100%"/>
        <frame id="windowActions"
               screen="extendedEditWindowActions"/>
    </layout>
</window>
